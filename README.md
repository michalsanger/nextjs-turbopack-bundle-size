# Next.js Turbopack Bundle Size

A GitHub Action that tracks Next.js App Router bundle sizes across pull requests. It stores a baseline on the `main` branch and posts a route-by-route size comparison comment on every PR.

## Usage

```yaml
- name: Analyze bundle sizes
  uses: michalsanger/nextjs-turbopack-bundle-size@v3
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    minimum-change-threshold: 256
    budget-percent-increase-red: 20
```

The action must run **after** the app has been built with `TURBOPACK_STATS=1`. See [`examples/usage.yml`](examples/usage.yml) for a complete workflow.

## Example PR Comment

The action posts a comment like this on every pull request:

> ## ğŸ“¦ Next.js App Router Sizes (Turbopack)
>
> This analysis was generated by the [Next.js Turbopack Bundle Size action](https://github.com/michalsanger/nextjs-turbopack-bundle-size). ğŸ¤–
>
> | Route | Size (gzipped) | Diff (vs main) |
> |---|---|---|
> | `/` | `85.2 KB` | ğŸŸ¢ `-1.5 KB` (-1.7%) |
> | `/about` | `42.3 KB` | ğŸ”´ `+3.1 KB` (+7.9%) |
> | `/blog` | `38.7 KB` | â– No change |
> | `/dashboard` | `51.4 KB` | ğŸŸ¡ `+800 B` (+1.6%) |
> | `/settings` | `29.1 KB` | ğŸ†• New |
> | `/old-page` | â€” | ğŸ—‘ï¸ Removed |

## Inputs

| Input | Required | Default | Description |
|---|---|---|---|
| `github-token` | Yes | â€” | GitHub token for downloading baseline artifact and posting PR comments |
| `stats-path` | No | `.next/server/webpack-stats.json` | Path to the Turbopack stats file |
| `artifact-name` | No | `turbopack-main-stats` | Artifact name for storing the baseline stats |
| `minimum-change-threshold` | No | `0` | Byte threshold below which a size change is considered unchanged. For example, `500` means changes of 500 B or less are shown as "â– No change". |
| `budget-percent-increase-red` | No | `0` | Percentage threshold for flagging size increases as critical. Increases above this percentage show ğŸ”´, others show ğŸŸ¡. Default `0` means all increases show ğŸ”´. For example, `20` means only increases above 20% are flagged red. |

## Required Permissions

```yaml
permissions:
  contents: read
  pull-requests: write
  actions: read
```

## How It Works

- **On push to `main`**: uploads `.next/server/webpack-stats.json` as a GitHub Actions artifact (the baseline).
- **On pull request**: downloads the baseline artifact, parses both stat files, calculates gzip sizes for each route, and posts (or updates) a sticky comment with a comparison table.

The first PR before any baseline exists will show all routes as "ğŸ†• New" â€” this is expected.

## Acknowledgements

Inspired by [nextjs-bundle-analysis](https://github.com/hashicorp/nextjs-bundle-analysis) by HashiCorp.
